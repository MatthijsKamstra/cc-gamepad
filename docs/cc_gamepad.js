// Generated by Haxe 4.1.4
(function ($global) { "use strict";
var CCGamepad = function() {
	this.axisMap = new haxe_ds_IntMap();
	this.btnMap = new haxe_ds_IntMap();
	this.map = new haxe_ds_IntMap();
	this.controllers = [];
	var _gthis = this;
	window.document.addEventListener("DOMContentLoaded",function(event) {
		$global.console.log("" + model_constants_App.NAME + " Dom ready :: build: " + "2020-09-16 12:03:19");
		_gthis.init();
	});
};
CCGamepad.__name__ = true;
CCGamepad.main = function() {
	var app = new CCGamepad();
};
CCGamepad.prototype = {
	init: function() {
		this.setupStart();
		this.setupListeners();
	}
	,setupStart: function() {
		var div = window.document.createElement("div");
		div.id = "start-screen";
		div.className = "container";
		div.innerHTML = "<h2>No gamepad detected</h2><p>If you have one, make sure it's plugged in / paired, and press buttons to wake it up.</p>";
		window.document.body.appendChild(div);
	}
	,setupListeners: function() {
		window.addEventListener("gamepadconnected",$bind(this,this.onGamepadConnectedHandler));
		window.addEventListener("gamepaddisconnected",$bind(this,this.onGamepadDisconnectedHandler));
		window.addEventListener("gamepadbuttondown",$bind(this,this.onGamepadButtonDownHandler));
		window.addEventListener("gamepadbuttonup",$bind(this,this.onGamepadButtonUpHandler));
		window.addEventListener("gamepadaxismove",$bind(this,this.onGamepadAxisMoveHandler));
	}
	,setupControllerValues: function() {
		var btnMap = new haxe_ds_IntMap();
		btnMap.h[0] = "X";
		btnMap.h[1] = "A";
		btnMap.h[2] = "B";
		btnMap.h[3] = "Y";
		btnMap.h[4] = "Left Bottom";
		btnMap.h[5] = "Right Bottom";
		btnMap.h[6] = "";
		btnMap.h[7] = "";
		btnMap.h[8] = "Select";
		btnMap.h[9] = "Start";
		var _GamePadObject = { _id : this.gamepad.id, alias : "fake super nintendo controller (snes)", gamepad : this.gamepad, buttonMap : btnMap};
		this.map.h[0] = _GamePadObject;
	}
	,setupInterface: function() {
		var btnArray = this.gamepad.buttons;
		var axixArray = this.gamepad.axes;
		var d = window.document.createElement("div");
		d.className = "container";
		d.setAttribute("id","controller" + this.gamepad.index);
		var t = window.document.createElement("h1");
		t.appendChild(window.document.createTextNode("gamepad: " + this.gamepad.id));
		d.appendChild(t);
		var t = window.document.createElement("div");
		t.id = "name-button";
		d.appendChild(t);
		this.btnNameField = t;
		var b = window.document.createElement("div");
		b.className = "buttons";
		var _g = 0;
		var _g1 = this.gamepad.buttons.length;
		while(_g < _g1) {
			var i = _g++;
			var e = window.document.createElement("span");
			e.className = "button";
			e.innerHTML = i == null ? "null" : "" + i;
			b.appendChild(e);
			this.btnMap.h[i] = e;
		}
		d.appendChild(b);
		var a = window.document.createElement("div");
		a.className = "axes";
		var _g = 0;
		var _g1 = this.gamepad.axes.length;
		while(_g < _g1) {
			var i = _g++;
			var p = window.document.createElement("progress");
			p.className = "axis";
			p.setAttribute("max","2");
			p.setAttribute("value","1");
			p.innerHTML = i == null ? "null" : "" + i;
			a.appendChild(p);
			this.axisMap.h[i] = p;
		}
		d.appendChild(a);
		var pre = window.document.createElement("pre");
		pre.innerText = "- id: " + this.gamepad.id + " \n- connected: " + Std.string(this.gamepad.connected) + "\n- index: " + this.gamepad.index;
		d.appendChild(pre);
		var start = window.document.getElementById("start-screen");
		if(start != null) {
			start.style.display = "none";
		}
		window.document.body.appendChild(d);
	}
	,onGamepadConnectedHandler: function(e) {
		$global.console.log("Gamepad connected",e.gamepad);
		this.gamePads = $global.navigator.getGamepads();
		$global.console.log(this.gamePads);
		this.gamepad = $global.navigator.getGamepads()[0];
		$global.console.log(this.gamepad);
		this.setupControllerValues();
		this.setupInterface();
		this.timeoutVariable = window.setInterval($bind(this,this.gameLoop),500);
	}
	,onGamepadDisconnectedHandler: function(e) {
		$global.console.log("Gamepad disconnected",e.gamepad);
		window.cancelAnimationFrame(this.start);
		window.clearTimeout(this.timeoutVariable);
	}
	,onGamepadButtonDownHandler: function(e) {
		$global.console.log("Gamepad button down",e.button,e.gamepad);
	}
	,onGamepadButtonUpHandler: function(e) {
		$global.console.log("Gamepad button up",e.button,e.gamepad);
	}
	,onGamepadAxisMoveHandler: function(e) {
		$global.console.log("Gamepad axis move",e.button,e.gamepad);
	}
	,gameLoop: function(value) {
		console.log("src/CCGamepad.hx:193:","");
		var el = this.btnMap.iterator();
		while(el.hasNext()) {
			var el1 = el.next();
			el1.classList.remove("pressed");
		}
		var _g = 0;
		var _g1 = this.gamepad.buttons.length;
		while(_g < _g1) {
			var i = _g++;
			var _button = this.gamepad.buttons[i];
			if(_button.pressed) {
				var el = this.btnMap.h[i];
				el.classList.add("pressed");
				var _gamePadObject = this.map.h[0];
				var temp = _gamePadObject.buttonMap.h[i];
				this.btnNameField.innerText = temp;
			}
		}
	}
	,applyDeadzone: function(number,threshold) {
		var percentage = (Math.abs(number) - threshold) / (1 - threshold);
		if(percentage < 0) {
			percentage = 0;
		}
		return percentage * (number > 0 ? 1 : -1);
	}
};
Math.__name__ = true;
var Std = function() { };
Std.__name__ = true;
Std.string = function(s) {
	return js_Boot.__string_rec(s,"");
};
var haxe_ds_IntMap = function() {
	this.h = { };
};
haxe_ds_IntMap.__name__ = true;
haxe_ds_IntMap.prototype = {
	keys: function() {
		var a = [];
		for( var key in this.h ) if(this.h.hasOwnProperty(key)) a.push(key | 0);
		return new haxe_iterators_ArrayIterator(a);
	}
	,iterator: function() {
		return { ref : this.h, it : this.keys(), hasNext : function() {
			return this.it.hasNext();
		}, next : function() {
			var i = this.it.next();
			return this.ref[i];
		}};
	}
};
var haxe_iterators_ArrayIterator = function(array) {
	this.current = 0;
	this.array = array;
};
haxe_iterators_ArrayIterator.__name__ = true;
haxe_iterators_ArrayIterator.prototype = {
	hasNext: function() {
		return this.current < this.array.length;
	}
	,next: function() {
		return this.array[this.current++];
	}
};
var js_Boot = function() { };
js_Boot.__name__ = true;
js_Boot.__string_rec = function(o,s) {
	if(o == null) {
		return "null";
	}
	if(s.length >= 5) {
		return "<...>";
	}
	var t = typeof(o);
	if(t == "function" && (o.__name__ || o.__ename__)) {
		t = "object";
	}
	switch(t) {
	case "function":
		return "<function>";
	case "object":
		if(((o) instanceof Array)) {
			var str = "[";
			s += "\t";
			var _g = 0;
			var _g1 = o.length;
			while(_g < _g1) {
				var i = _g++;
				str += (i > 0 ? "," : "") + js_Boot.__string_rec(o[i],s);
			}
			str += "]";
			return str;
		}
		var tostr;
		try {
			tostr = o.toString;
		} catch( _g ) {
			return "???";
		}
		if(tostr != null && tostr != Object.toString && typeof(tostr) == "function") {
			var s2 = o.toString();
			if(s2 != "[object Object]") {
				return s2;
			}
		}
		var str = "{\n";
		s += "\t";
		var hasp = o.hasOwnProperty != null;
		var k = null;
		for( k in o ) {
		if(hasp && !o.hasOwnProperty(k)) {
			continue;
		}
		if(k == "prototype" || k == "__class__" || k == "__super__" || k == "__interfaces__" || k == "__properties__") {
			continue;
		}
		if(str.length != 2) {
			str += ", \n";
		}
		str += s + k + " : " + js_Boot.__string_rec(o[k],s);
		}
		s = s.substring(1);
		str += "\n" + s + "}";
		return str;
	case "string":
		return o;
	default:
		return String(o);
	}
};
var model_constants_App = function() { };
model_constants_App.__name__ = true;
var $_;
function $bind(o,m) { if( m == null ) return null; if( m.__id__ == null ) m.__id__ = $global.$haxeUID++; var f; if( o.hx__closures__ == null ) o.hx__closures__ = {}; else f = o.hx__closures__[m.__id__]; if( f == null ) { f = m.bind(o); o.hx__closures__[m.__id__] = f; } return f; }
$global.$haxeUID |= 0;
String.__name__ = true;
Array.__name__ = true;
js_Boot.__toStr = ({ }).toString;
model_constants_App.NAME = "[cc-gamepad]";
CCGamepad.main();
})(typeof window != "undefined" ? window : typeof global != "undefined" ? global : typeof self != "undefined" ? self : this);

//# sourceMappingURL=cc_gamepad.js.map